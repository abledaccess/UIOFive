var fluid_2_0=fluid_2_0||{};!function($,fluid){"use strict";fluid.registerNamespace("fluid.textToSpeech"),fluid.textToSpeech.isSupported=function(){return!(!window||!window.speechSynthesis)},fluid.defaults("fluid.textToSpeech",{gradeNames:["fluid.standardRelayComponent","autoInit"],events:{onStart:null,onStop:null,onPause:null,onResume:null,onError:null,onSpeechQueued:null},members:{queue:[]},model:{utteranceOpts:{}},modelListeners:{speaking:{listener:"fluid.textToSpeech.speak",args:["{that}","{change}.value"]},paused:{listener:"fluid.textToSpeech.pause",args:["{that}","{change}.value"]}},invokers:{queueSpeech:{funcName:"fluid.textToSpeech.queueSpeech",args:["{that}","{arguments}.0","{arguments}.1","{arguments}.2"]},cancel:{funcName:"fluid.textToSpeech.cancel",args:["{that}"]},pause:{"this":"speechSynthesis",method:"pause"},resume:{"this":"speechSynthesis",method:"resume"},getVoices:{"this":"speechSynthesis",method:"getVoices"},handleStart:{funcName:"fluid.textToSpeech.handleStart",args:["{that}"]},handleEnd:{funcName:"fluid.textToSpeech.handleEnd",args:["{that}"]},handleError:"{that}.events.onError.fire",handlePause:{changePath:"paused",value:!0},handleResume:{changePath:"paused",value:!1}}}),fluid.textToSpeech.speak=function(that,speaking){that.events[speaking?"onStart":"onStop"].fire()},fluid.textToSpeech.pause=function(that,paused){paused?that.events.onPause.fire():that.model.speaking&&that.events.onResume.fire()},fluid.textToSpeech.handleStart=function(that){that.queue.shift(),that.applier.change("speaking",!0),that.queue.length&&that.applier.change("pending",!0)},fluid.textToSpeech.handleEnd=function(that){var resetValues={speaking:!1,pending:!1,paused:!1};if(!that.queue.length){var newModel=$.extend({},that.model,resetValues);that.applier.change("",newModel)}},fluid.textToSpeech.queueSpeech=function(that,text,interrupt,options){interrupt&&that.cancel();var errorFn=function(){that.handleError(text)},toSpeak=new SpeechSynthesisUtterance(text),eventBinding={onstart:that.handleStart,onend:that.handleEnd,onerror:errorFn,onpause:that.handlePause,onresume:that.handleResume};$.extend(toSpeak,that.model.utteranceOpts,options,eventBinding),that.queue.push(text),that.events.onSpeechQueued.fire(text),speechSynthesis.speak(toSpeak)},fluid.textToSpeech.cancel=function(that){that.queue=[],speechSynthesis.cancel()}}(jQuery,fluid_2_0);